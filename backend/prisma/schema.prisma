// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         Int                 @id @unique @default(autoincrement())
  userInformation            UserInformation?     
  authentication             Authentication?
  userContribution           UserContribution?
  userTraining               UserTraining?
}


model UserInformation {
  id                        Int                  @id @unique @default(autoincrement())
  informationUser           User?                 @relation(fields: [userId], references: [id], map: "user_information_user_fk")
  userId                    Int                  @unique 
  email                     String               @unique
  username                  String?              @unique
  name                      String?
  password                  String
  mobileNum                 String?
  role                      Roles                @default(USER)
  profilePic                String?
  gender                    Gender?
  collegeId                 String?
  graduationYear            Int?
  cgpa                      Float?
  college                   String?
  department                Department?
  course                    Course?
  state                     String?
  hosteler                  Boolean?
  leetcodeProfile           String?
  codeforcesProfile         String?
  linkedinProfile           String?
  githubProfile             String?  
}

model Authentication {
  id                        Int                  @id @unique @default(autoincrement())
  authenticationUser        User?                 @relation(fields: [userId], references: [id], map: "authentication_user_fk")
  userId                    Int                  @unique
  otpForEmail               String?
  otpEmailExpiry            DateTime?
  otpForExtra               String?
  otpExtraExpiry            DateTime?
  isVerified                Boolean              @default(false)
  isBoarded                 Boolean              @default(false)
}

model UserContribution {
  id                        Int                  @id @unique @default(autoincrement())
  contributionUser          User?                 @relation(fields: [userId], references: [id], map: "user_contribution_user_fk")
  userId                    Int                  @unique
  interview                 Interview[]
  questions                 Question[]
  quizes                    Quiz[]
  articles                  Article[]
  contributionPoints        Int                   @default(0)
}

model UserTraining {
  id                        Int                   @id @unique @default(autoincrement())
  trainingUser              User?                  @relation(fields: [userId], references: [id], map: "user_training_user_fk")
  userId                    Int                   @unique
  interview                 Interview[]
  quizesAttended            QuizAttendance[]
  trainingPoints            Int                   @default(0)
}

model Question {
  id                        Int                   @id @unique @default(autoincrement())
  description               String
  answer                    String?
  creator                   UserContribution      @relation(fields: [createdBy], references: [id], map: "question_user_contribution_fk")
  createdBy                 Int
  tags                      String[]
  links                     QueAddOnLink[]
  isApproved                Boolean               @default(false)
  isVisibile                Boolean               @default(false)
  upvotes                   Int                   @default(0)
  downvotes                 Int                   @default(0)
}

model QueAddOnLink {
  id                        Int                   @id @unique @default(autoincrement())
  question                  Question              @relation(fields: [questionId], references: [id], map: "question_add_onlink_fk")
  questionId                Int
  title                     String
  url                       String
}

model Quiz {
  id                        Int                   @id @unique @default(autoincrement())
  creator                   UserContribution      @relation(fields: [createdBy], references: [id], map: "quiz_user_contribution_fk")
  createdBy                 Int                   @unique
  title                     String
  description               String?
  questions                 QuizQuestion[] 
  startTime                 DateTime
  endTime                   DateTime
  isVisibile                Boolean               @default(false)
  attendees                 QuizAttendance[]
}

model QuizAttendance {
  id                        Int                   @id @unique @default(autoincrement())
  quiz                      Quiz                  @relation(fields: [quizId], references: [id], map: "quiz_qttendence_quiz_fk")
  quizId                    Int
  attendee                  UserTraining          @relation(fields: [userId], references: [id], map: "quiz_attendence_traingin_fk")
  userId                    Int
  score                     Int
}

model QuizQuestion {
  id                        Int                   @id @unique @default(autoincrement())
  quiz                      Quiz                  @relation(fields: [quizId], references: [id], map: "quiz_question_quiz_fk")
  quizId                    Int
  description               String
  options                   String[]
  correctOption             Int  
}

model Article {
  id                        Int                   @id @unique @default(autoincrement())
  creator                   UserContribution      @relation(fields: [createdBy], references: [id], map: "article_user_fk")
  createdBy                 Int
  title                     String
  description               String
  isApproved                Boolean               @default(false)
  isVisibile                Boolean               @default(false)
}

model Interview {
  id                        Int                   @id @unique @default(autoincrement())
  interviewer               UserContribution?      @relation(fields: [interviewerId], references: [id], map: "interviewer_user_contribution_fk")
  interviewee               UserTraining          @relation(fields: [intervieweeId], references: [id], map: "interviewee_user_contribution_fk")
  interviewerId             Int?
  intervieweeId             Int
  startTime                 DateTime
  duration                  Int 
  topics                    String[]
  isCompleted               Boolean               @default(false)
  feedback                  Feedback?
}

model Feedback {
  id                        Int                   @id @unique @default(autoincrement())
  interview                 Interview             @relation(fields: [interviewId], references: [id], map: "feedback_interview_fk")
  interviewId               Int                   @unique
  communication             Int                   @default(0)
  development               Int                   @default(0)
  dsa                       Int                   @default(0)
  csfundamentals            Int                   @default(0)
  notes                     String[]
  points                    Int                   @default(0)
}

enum Roles {
  USER
  ADMIN
  SUPERADMIN
  MANAGER
}

enum Gender {
  MALE
  FEMALE
  TRANSGENDER
  PREFER_NOT_TO_SAY
}

enum Department {
  COMPUTER_SCIENCE_AND_ENGINEERING
  ELECTRONICS_AND_INSTRUMENTATION_ENGINEERING
  ELECTRONICS_AND_COMMUNICATIONS_ENGINEERING
  ELECTRICAL_ENGINEERING
  MECHANICAL_ENGINEERING
  CHEMICAL_ENGINEERING
  CIVIL_ENGINEERING
  PRODUCTION_ENGINEERING
  BIO_TECH_AND_BIO_ENGINEERING
}

enum Course {
  BTech
  PhD
  MCA
  MTech
}